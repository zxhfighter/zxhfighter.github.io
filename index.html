<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.1" />






<meta name="description" content="frontend, angular, angularjs, typescript, rxjs, spa, ionic, vue, vue.js, react, native react, nativescript">
<meta property="og:type" content="website">
<meta property="og:title" content="前端花园">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="前端花园">
<meta property="og:description" content="frontend, angular, angularjs, typescript, rxjs, spa, ionic, vue, vue.js, react, native react, nativescript">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端花园">
<meta name="twitter:description" content="frontend, angular, angularjs, typescript, rxjs, spa, ionic, vue, vue.js, react, native react, nativescript">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9b56b7702f31d1fe7fab8b57548b41de";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  <title>前端花园</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端花园</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">frontend garden</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="fullscreen">
            <i class="fa fa-arrows-alt" aria-hidden="true"></i>
            &nbsp;&nbsp;<span id="fullscreen-text">全屏阅读</span>
          </div>
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/05/primeng-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zxhfighter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端花园">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/05/primeng-analysis/" itemprop="url">Angular 组件库 primeng 剖析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-05T00:00:00+08:00">
                2017-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/angular/" itemprop="url" rel="index">
                    <span itemprop="name">angular</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/angular/primeng/" itemprop="url" rel="index">
                    <span itemprop="name">primeng</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://primefaces.org/primeng/" target="_blank" rel="external">primeng</a> 是目前市面上一个比较优秀的 Angular 组件库，组件种类多且全，可定制化程度高，文档也写得通俗易懂。</p>
<p>本文将对 primeng 组件库进行简单分析，抛砖引玉，希望能对编写你自己的组件库有所帮助。</p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>进入项目目录后，运行 <code>tree -L 1 .</code>（如果没有安装 <code>tree</code> 命令，使用 <code>brew install tree</code> 安装），查看目录结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ tree -L 1 .</div><div class="line">.</div><div class="line">├── .angular-cli.json      --- angular-cli 配置文件</div><div class="line">├── LICENSE.md             --- 使用 MIT LICENSE</div><div class="line">├── README.md              --- README</div><div class="line">├── e2e                    --- 基于 Protractor 的集成（端到端）测试，包括几个基础组件</div><div class="line">├── gulpfile.js            --- 使用 gulp 来处理一些 css 和 image 资源</div><div class="line">├── karma.conf.js          --- karma 测试配置文件</div><div class="line">├── package.json           --- package.json</div><div class="line">├── primeng.d.ts           --- 使用 es2015 模块语法导出所有组件中定义的对象</div><div class="line">├── primeng.js             --- 使用 commonjs 模块语法导出所有组件中定义的对象</div><div class="line">├── protractor.conf.js     --- e2e 集成测试配置文件，会运行 e2e 中定义的测试 case</div><div class="line">├── src                    --- 源目录</div><div class="line">├── tsconfig-aot.json      --- 编译配置文件，使用 aot 构建，暂时没有看到使用的地方</div><div class="line">├── tsconfig-release.json  --- 编译配置文件，暂时没有看到使用的地方</div><div class="line">├── tsconfig.json          --- 编译基本配置，会被 src 和 e2e 目录下的配置文件所继承（extends）</div><div class="line">└── tslint.json            --- lint 配置</div></pre></td></tr></table></figure>
<p>可以看出，primeng 项目结构也采用了 angular-cli 搭建，相比 angular-cli 初始化的项目，多了如下四个文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">primeng.d.ts</div><div class="line">primeng.js</div><div class="line">tsconfig-aot.json</div><div class="line">tsconfig-release.json</div></pre></td></tr></table></figure>
<p>不过暂时没有看到 <code>tsconfig-aot.json</code> 和 <code>tsconfig-release.json</code> 两个编译配置文件用在何处。</p>
<p>再来看下 src 目录下的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ tree -L 2 .</div><div class="line"></div><div class="line">.</div><div class="line">├── app</div><div class="line">│   ├── components            --- 组件库，每个组件一个模块</div><div class="line">│   └── showcase              --- demo库</div><div class="line">├── assets                    --- 全局资源，包括图片(images)和主题样式(themes)</div><div class="line">│   ├── components            --- 组件库用到的资源</div><div class="line">│   └── showcase              --- demo库用到的资源</div><div class="line">├── environments              --- 环境变量配置</div><div class="line">│   ├── environment.prod.ts   --- 生成环境变量配置</div><div class="line">│   └── environment.ts        --- 开发环境变量配置</div><div class="line">├── favicon.png</div><div class="line">├── index.html                --- 主页</div><div class="line">├── main.ts                   --- 入口文件</div><div class="line">├── polyfills.ts              --- polyfills，包括 core-js、zone.js、intl、web-animations-js 等</div><div class="line">├── styles.css                --- 全局样式</div><div class="line">├── test.ts                   --- 测试入口文件</div><div class="line">├── tsconfig.app.json         --- 主项目编译文件</div><div class="line">├── tsconfig.spec.json        --- 测试编译文件</div><div class="line">├── typings.d.ts              --- 自定义类型</div><div class="line">└── upload.php                --- 上传处理页</div></pre></td></tr></table></figure>
<h2 id="组件设计"><a href="#组件设计" class="headerlink" title="组件设计"></a>组件设计</h2><p>组件的代码位于 <code>src/app/components</code> 目录中，组件的一些设计思路如下：</p>
<ul>
<li><strong>一个组件一个模块</strong></li>
</ul>
<p>这样可以很方便的按需引入组件，也利于组件的开发和维护。</p>
<p>另外，为了方便，在一个文件中定义了多个组件（一般是该组件的一些依赖组件），以及该包含该组件的模块。</p>
<ul>
<li>组件样式<strong>全局引入</strong></li>
</ul>
<p>组件样式不在组件中单独引入，那样会给所有组件样式添加默认的 scope 限定（<code>encapsulation = ViewEncapsulation.Emulated</code>），如果外层需要覆盖内层组件样式，会很不方便。因此组件的样式全部在 <code>src/styles.css</code> 中引入。当然也可以将 <code>encapsulation</code> 设置成 <code>ViewEncapsulation.None</code> 来避免 scope 限定，这两种方式二选一即可。</p>
<p><code>styles.css</code> 内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">import</span> <span class="string">'assets/showcase/css/primeng.css'</span>;</div><div class="line">@<span class="keyword">import</span> <span class="string">'assets/showcase/css/code.css'</span>;</div><div class="line">@<span class="keyword">import</span> <span class="string">'assets/showcase/css/site.css'</span>;</div></pre></td></tr></table></figure>
<p><code>assets/showcase/css/primeng.css</code> 文件引入了所有 components 的样式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">import</span> <span class="string">'../../../app/components/common/common.css'</span>;</div><div class="line">@<span class="keyword">import</span> <span class="string">'../../../app/components/autocomplete/autocomplete.css'</span>;</div><div class="line">@<span class="keyword">import</span> <span class="string">'../../../app/components/accordion/accordion.css'</span>;</div><div class="line"><span class="comment">/* ... */</span></div></pre></td></tr></table></figure>
<ul>
<li>全部内联模板</li>
</ul>
<p>primeng 全部将模板写成了内联模板，优点是文件内容紧凑，不会分散注意力；缺点就是缺乏语法高亮，编写HTML模板无法使用 emmet 等自动语法提示。</p>
<p>在组件库中，有两个文件夹值得特别注意。</p>
<h3 id="common-文件夹"><a href="#common-文件夹" class="headerlink" title="common 文件夹"></a>common 文件夹</h3><p>在 <code>common.css</code> 中定义了通用样式，例如 <code>.ui-widget</code>、<code>.ui-helper-reset</code>等，这些通用样式对于更换主题意义重大。</p>
<p>此外，其余大部分文件定义了组件库使用的一些全局性类型接口，例如广泛使用的 <code>menuitem</code> 结构。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// menuitem.ts</span></div><div class="line"><span class="keyword">export</span> interface MenuItem &#123;</div><div class="line">    label?: string;</div><div class="line">    icon?: string;</div><div class="line">    command?: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>;</div><div class="line">    url?: string;</div><div class="line">    routerLink?: any;</div><div class="line">    items?: MenuItem[];</div><div class="line">    expanded?: boolean;</div><div class="line">    disabled?: boolean;</div><div class="line">    visible?: boolean;</div><div class="line">    target?: string;</div><div class="line">    routerLinkActiveOptions?: any;</div><div class="line">    separator?: boolean;</div><div class="line">    badge?: string;</div><div class="line">    badgeStyleClass?: string;</div><div class="line">    style?:any;</div><div class="line">    styleClass?:string;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外，在 <code>shared.ts</code> 中，定义了一些通用的模板组件，例如 <code>p-header</code>、<code>p-column</code>、<code>p-templateLoader</code> 等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// shared.ts</span></div><div class="line">@Component(&#123;</div><div class="line">    selector: <span class="string">'p-header'</span>,</div><div class="line">    template: <span class="string">'&lt;ng-content&gt;&lt;/ng-content&gt;'</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">    selector: <span class="string">'p-footer'</span>,</div><div class="line">    template: <span class="string">'&lt;ng-content&gt;&lt;/ng-content&gt;'</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Footer</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure>
<h3 id="dom-文件夹"><a href="#dom-文件夹" class="headerlink" title="dom 文件夹"></a>dom 文件夹</h3><p>尽管不推荐直接操作 dom，但是对于一个组件库来说，操作 dom 是无法避免的，因此 <code>domhandler.ts</code> 文件封装了大部分 dom 操作。</p>
<ul>
<li><code>addClass</code></li>
<li><code>addMultipleClasses</code></li>
<li><code>removeClass</code></li>
<li><code>hasClass</code></li>
<li><code>siblings</code></li>
<li><code>find</code></li>
<li><code>findSingle</code></li>
<li><code>index</code></li>
<li><code>relativePosition</code></li>
<li><code>absolutePosition</code></li>
<li><code>getHiddenElementOuterHeight</code></li>
<li><code>getHiddenElementOuterWidth</code></li>
<li><code>getHiddenElementDimensions</code></li>
<li><code>scrollInView</code></li>
<li><code>fadeIn</code></li>
<li><code>fadeOut</code></li>
<li><code>getWindowScrollTop</code></li>
<li><code>getWindowScrollLeft</code></li>
<li><code>matches</code></li>
<li><code>getOuterWidth</code></li>
<li><code>getHorizontalPadding</code></li>
<li><code>getHorizontalMargin</code></li>
<li><code>innerWidth</code></li>
<li><code>width</code></li>
<li><code>getInnerHeight</code></li>
<li><code>getOuterHeight</code></li>
<li><code>getHeight</code></li>
<li><code>getWidth</code></li>
<li><code>getViewport</code></li>
<li><code>getOffset</code></li>
<li><code>getUserAgent</code></li>
<li><code>isIE</code></li>
<li><code>appendChild</code></li>
<li><code>removeChild</code></li>
<li><code>isElement</code></li>
<li><code>calculateScrollbarWidth</code></li>
<li><code>invokeElementMethod</code></li>
<li><code>clearSelection</code></li>
</ul>
<p>看到这么一大串方法列表，有人会疑惑，这不就是提取了 jQuery 的一部分功能吗，为什么不直接引入 jQuery 呢？</p>
<p>这里就涉及到一个库的设计原则：<strong>组件库的设计应该纯粹，能够拿来开箱即用，而不用再去配置组件库的一些依赖</strong>。</p>
<p>如果要引入 jQuery，如果使用 es2015 的模块按需引用，那么需要手动去配置 jQuery 依赖；如果采取全量引入，那就需要在构建时将 jQuery 代码打包到最终的构建输出中，这并不是一个很好的设计方案。</p>
<p>因此，这里自己实现了一个 jQuery 的 mini 集合来操作 dom。</p>
<h3 id="组件例子"><a href="#组件例子" class="headerlink" title="组件例子"></a>组件例子</h3><p>以组件 accordion 为例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// accordion.ts</span></div><div class="line"><span class="comment">// import list</span></div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">    selector: <span class="string">'p-accordion'</span>,</div><div class="line">    template: <span class="string">`</span></div><div class="line"><span class="string">        &lt;div [ngClass]="'ui-accordion ui-widget ui-helper-reset'" [ngStyle]="style" [class]="styleClass"&gt;</span></div><div class="line"><span class="string">            &lt;ng-content&gt;&lt;/ng-content&gt;</span></div><div class="line"><span class="string">        &lt;/div&gt;</span></div><div class="line"><span class="string">    `</span>,</div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Accordion</span> <span class="title">implements</span> <span class="title">BlockableUI</span> </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">    selector: <span class="string">'p-accordionTab'</span>,</div><div class="line">    template: <span class="string">`</span></div><div class="line"><span class="string">        &lt;div class="ui-accordion-header"&gt;</span></div><div class="line"><span class="string">        &lt;/div&gt;</span></div><div class="line"><span class="string">        &lt;div class="ui-accordion-content-wrapper"&gt;</span></div><div class="line"><span class="string">        &lt;/div&gt;</span></div><div class="line"><span class="string">    `</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AccordionTab</span> <span class="title">implements</span> <span class="title">OnDestroy</span> </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">@NgModule(&#123;</div><div class="line">    imports: [CommonModule],</div><div class="line">    exports: [Accordion,AccordionTab],</div><div class="line">    declarations: [Accordion,AccordionTab]</div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AccordionModule</span> </span>&#123; &#125;</div></pre></td></tr></table></figure>
<p>文件中定义了一个模块 <code>AccordionModule</code>，容器组件 <code>p-accordion</code>，以及面板组件 <code>p-accordionTab</code>。当然也可以分为三个文件去定义组件和模块，这两种代码组织方式也是仁者见仁，智者见智的问题。</p>
<h2 id="主题样式"><a href="#主题样式" class="headerlink" title="主题样式"></a>主题样式</h2><p>primeng 的主题样式采取了组件结构层样式（css）和表现层样式（scss）分离的策略，也即：</p>
<ul>
<li>结构层样式：只定义组件的结构相关的属性，例如 box-model 相关属性 <code>display</code>，<code>position</code>，<code>padding</code>，<code>margin</code>等</li>
<li>表现层样式：定义组件展现的外观属性，例如 <code>border</code>，<code>color</code>，<code>background</code>，<code>transition</code>，<code>outline</code>，<code>box-shadow</code>等</li>
</ul>
<p>以 Button 为例，在 <code>src/app/components/button/button.css</code> 中，定义了按钮结构层相关样式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Button */</span></div><div class="line"><span class="selector-class">.ui-button</span> &#123;</div><div class="line">    <span class="attribute">display</span>: inline-block;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">margin-right</span>: .<span class="number">1em</span>;</div><div class="line">    <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</div><div class="line">    <span class="attribute">cursor</span>: pointer;</div><div class="line">    <span class="attribute">text-align</span>: center;</div><div class="line">    <span class="attribute">zoom</span>: <span class="number">1</span>;</div><div class="line">    <span class="attribute">overflow</span>: visible; <span class="comment">/* the overflow property removes extra width in IE */</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.ui-button-icon-only</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">2em</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*button text element */</span></div><div class="line"><span class="selector-class">.ui-button</span> <span class="selector-class">.ui-button-text</span> &#123;</div><div class="line">    <span class="attribute">display</span>: block;</div><div class="line">    <span class="attribute">line-height</span>: normal;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 <code>src/assets/components/themes/_theme.scss</code> 中，定义了组件的一些基础表现层样式，例如所有的组件都包含有 <code>ui-widget</code> 类，该类定义如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.ui-widget</span> &#123;</div><div class="line">    <span class="attribute">font-family</span>:  $fontFamily;</div><div class="line">    <span class="attribute">font-size</span>: $fontSize;</div><div class="line"></div><div class="line">    input, select, textarea, button &#123;</div><div class="line">        font-family:  $fontFamily;</div><div class="line">        font-size: $fontSize;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="selector-pseudo">:active</span> &#123;</div><div class="line">        <span class="attribute">outline</span>: none;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.ui-widget-content</span> &#123;</div><div class="line">    <span class="attribute">border</span>: $contentBorderWidth solid $contentBorderColor;</div><div class="line">    <span class="attribute">background</span>: $contentBgColor;</div><div class="line">    <span class="attribute">color</span>: $contentTextColor;</div><div class="line"></div><div class="line">    a &#123;</div><div class="line">        color: $contentTextColor;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这两个样式类定义了所有组件的通用表现样式，例如字体、边框、背景色、前景色、链接颜色等。</p>
<p>其中的变量，例如 <code>$fontFamily</code>，<code>$contentBorderWidth</code> 则在主题文件中去定义，primeng 提供了相当多的主题，你也可以很轻松的自定义自己的主题。</p>
<p>例如，看下主题 <code>cruze</code> 的样式实现。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* src/assets/components/themes/cruze/theme.scss */</span></div><div class="line"></div><div class="line">$fontFamily: Segoe UI, Arial, sans-serif;</div><div class="line">$fontSize: 1em;</div><div class="line">$borderRadius: 6px;</div><div class="line">$disabledOpacity: 0.35;</div><div class="line"></div><div class="line">//Content</div><div class="line">$contentBorderWidth: 1px;</div><div class="line">$contentBorderColor: #dddddd;</div><div class="line">$contentBgColor: #ffffff;</div><div class="line">$contentTextColor: #444444;</div><div class="line"></div><div class="line"><span class="comment">/* ... */</span></div><div class="line"></div><div class="line">@<span class="keyword">import</span> <span class="string">'../_theme'</span>;</div></pre></td></tr></table></figure>
<p>你也可以写一个自己的主题配置文件来实现轻松换肤的要求。</p>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p>文档就是 <code>src/app/showcase</code> 模块，在该模块中引入了 <code>src/app/components</code> 中的组件，编写相应的帮助文档。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>primeng 暂时没有包含组件单元测试，只有在 e2e 文件夹有几个集成测试。</p>
<p>个人建议如果时间精力足够的话，每个组件还是需要写上单测。</p>
<p>后续有时间，会抽出几个有代表性的组件进行分析，敬请期待。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/01/webpack-amd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zxhfighter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端花园">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/01/webpack-amd/" itemprop="url">用 webpack 构建 AMD 项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-01T00:00:00+08:00">
                2017-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack/" itemprop="url" rel="index">
                    <span itemprop="name">webpack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题缘起"><a href="#问题缘起" class="headerlink" title="问题缘起"></a>问题缘起</h2><p>最近接手了一个历史遗留项目，找不到构建代码了，作为一个前端的基本素养，不能直接将源码丢在线上吧，还是得完善项目的构建，先需要好好分析下项目代码。</p>
<h2 id="项目分析"><a href="#项目分析" class="headerlink" title="项目分析"></a>项目分析</h2><blockquote>
<p>项目是一个 AMD 项目，采用了百度的 <a href="https://github.com/ecomfe/esl" target="_blank" rel="external">esl</a>（类似 require.js）作为加载器，使用了 jquery、underscore 等基本库，另外还用了 echarts 和 raphael 等库来做一些视觉渲染，样式直接使用了 css。</p>
</blockquote>
<p>其中 esl 加载脚本的配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    urlArgs: <span class="string">'ver='</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime(),</div><div class="line">    baseUrl: <span class="string">'./src'</span>,</div><div class="line">    paths: &#123;</div><div class="line">        text : <span class="string">'../lib/require.text'</span>,</div><div class="line">        jquery: <span class="string">'../lib/jquery'</span>,</div><div class="line">        underscore: <span class="string">'../lib/underscore'</span>,</div><div class="line">        echarts: <span class="string">'../lib/echarts'</span>,</div><div class="line">        raphael: <span class="string">'../lib/raphael'</span>,</div><div class="line">        z: <span class="string">'../lib/z'</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>看起来并不是特别的复杂，另外 webpack 可以处理各种类型的模块（AMD、commonjs、es6 modules），对于<strong>一切皆是模块</strong>的 webpack 来说，构建也应该不会太难。</p>
<h2 id="webpack-配置"><a href="#webpack-配置" class="headerlink" title="webpack 配置"></a>webpack 配置</h2><p>首先安装 webpack 相关库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> webpack 相关</div><div class="line"><span class="meta">$</span> npm i -D webpack webpack-merge</div><div class="line"></div><div class="line"><span class="meta">#</span> babel 相关</div><div class="line"><span class="meta">$</span> npm i -D babel-core babel-loader babel-plugin-transform-runtime babel-preset-es2015 babel-preset-stage-2</div><div class="line"></div><div class="line"><span class="meta">#</span> loader 相关</div><div class="line"><span class="meta">$</span> npm i -D css-loader style-loader raw-loader file-loader url-loader</div><div class="line"></div><div class="line"><span class="meta">#</span> plugin 相关</div><div class="line"><span class="meta">$</span> npm i -D copy-webpack-plugin html-webpack-plugin html-withimg-loader</div></pre></td></tr></table></figure>
<p>新建 webpack 配置文件 <code>webpack.config.js</code>。</p>
<h2 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h2><p>首先配置输入和输出。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">loc</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> path.join(__dirname, <span class="string">'.'</span>, loc);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    entry: &#123;</div><div class="line">        show: [resolve(<span class="string">'src/show.js'</span>)]</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    output: &#123;</div><div class="line">        path: resolve(<span class="string">'dist'</span>),</div><div class="line">        filename: <span class="string">'[name].[hash:6].js'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h2><p>由于库文件没有使用 node_modules，而是位于 lib 目录，因此需要配置别名来定位这些库文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    resolve: &#123;</div><div class="line">        extensions: [<span class="string">'.js'</span>, <span class="string">'.json'</span>],</div><div class="line">        alias: &#123;</div><div class="line">            jquery: resolve(<span class="string">'lib/jquery.js'</span>),</div><div class="line">            underscore: resolve(<span class="string">'lib/underscore.js'</span>),</div><div class="line">            echarts: resolve(<span class="string">'lib/echarts.js'</span>),</div><div class="line">            z: resolve(<span class="string">'lib/z.js'</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对比之前的 esl 配置，可以看到用于加载文本（此项目用于加载 html 模板）的 amd 插件 <code>require.text</code> 没有配置别名，后续会通过 loader 进行处理。</p>
<h2 id="配置-loaders"><a href="#配置-loaders" class="headerlink" title="配置 loaders"></a>配置 loaders</h2><p>配置 loader 之前需要分析项目中所有的 <code>require()</code>，找出所有的可能文件后缀，只有这样才知道用什么样的 loader 来处理这类型的文件。</p>
<p>另外需要将 <code>require()</code> 的路径改成相对路径（例如从 <code>require(&quot;lib/abc&quot;)</code> 需要改成 <code>require(&quot;./lib/abc&quot;)</code>），html 文件以及 css 文件中相关资源的路径也需要保证引用正确。</p>
<p>此项目比较特殊的是，需要用 <code>html-withimg-loader</code> 来处理 html 模板文件，该 loader 会处理 html 中的图片引用（查阅了下，<code>html-loader</code> 也可以）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> appPath = resolve(<span class="string">'src'</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="built_in">module</span>: &#123;</div><div class="line">        rules: [</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.js$/</span>,</div><div class="line">                loader: <span class="string">'babel-loader'</span>,</div><div class="line">                include: [appPath]</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.(htm|html|tpl)$/i</span>,</div><div class="line">                loader: <span class="string">'html-withimg-loader'</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.css$/</span>,</div><div class="line">                use: [</div><div class="line">                    <span class="string">'style-loader'</span>,</div><div class="line">                    <span class="string">'css-loader'</span></div><div class="line">                ]</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span>,</div><div class="line">                loader: <span class="string">'url-loader?limit=10000'</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.(woff2?|eot|ttf|otf)(\?.*)?$/</span>,</div><div class="line">                loader: <span class="string">'url-loader?limit=10000'</span></div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="配置-plugins"><a href="#配置-plugins" class="headerlink" title="配置 plugins"></a>配置 plugins</h2><p>我们需要将 lib 目录下的代码打包成一个文件，需要使用 <code>CommonsChunkPlugin</code> 插件。</p>
<p>同时需要使用 <code>HtmlWebpackPlugin</code> 插件来动态生成 html 文件。</p>
<p>最后，还需要拷贝一些资源目录到构建目录，因此需要借助 <code>CopyWebpackPlugin</code> 插件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    plugins: [</div><div class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</div><div class="line">            template: resolve(<span class="string">'show.html'</span>),</div><div class="line">            inject: <span class="string">'body'</span>,</div><div class="line">            hash: <span class="literal">false</span></div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="keyword">new</span> CommonsChunkPlugin(&#123;</div><div class="line">            name: <span class="string">'vendor'</span>,</div><div class="line">            chunks: [<span class="string">'show'</span>],</div><div class="line">            minChunks: <span class="function"><span class="params">module</span> =&gt;</span> /lib/.test(<span class="built_in">module</span>.resource)</div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="keyword">new</span> CopyWebpackPlugin([&#123;</div><div class="line">            <span class="keyword">from</span>: resolve(<span class="string">'./show/reports'</span>),</div><div class="line">            to: resolve(<span class="string">'./dist/images'</span>)</div><div class="line">        &#125;]),</div><div class="line"></div><div class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</div><div class="line">            compress: &#123;</div><div class="line">                screw_ie8: <span class="literal">true</span></div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>webpack 是一个很强大的 bundle 工具，尤其是 <strong>一切皆模块</strong> 的思想可以很方便的用来处理各种资源复杂的依赖关系。</p>
<p>附录完整的配置文件如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</div><div class="line"><span class="keyword">const</span> CommonsChunkPlugin = <span class="built_in">require</span>(<span class="string">'webpack/lib/optimize/CommonsChunkPlugin'</span>);</div><div class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">loc</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> path.join(__dirname, <span class="string">'.'</span>, loc);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> appPath = resolve(<span class="string">'src'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    entry: &#123;</div><div class="line">        show: [resolve(<span class="string">'src/show.js'</span>)]</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    output: &#123;</div><div class="line">        path: resolve(<span class="string">'dist'</span>),</div><div class="line">        filename: <span class="string">'[name].[hash:6].js'</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    resolve: &#123;</div><div class="line">        extensions: [<span class="string">'.js'</span>, <span class="string">'.json'</span>],</div><div class="line">        alias: &#123;</div><div class="line">            jquery: resolve(<span class="string">'lib/jquery.js'</span>),</div><div class="line">            underscore: resolve(<span class="string">'lib/underscore.js'</span>),</div><div class="line">            echarts: resolve(<span class="string">'lib/echarts.js'</span>),</div><div class="line">            z: resolve(<span class="string">'lib/z.js'</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="built_in">module</span>: &#123;</div><div class="line">        rules: [</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.js$/</span>,</div><div class="line">                loader: <span class="string">'babel-loader'</span>,</div><div class="line">                include: [appPath]</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.(htm|html|tpl)$/i</span>,</div><div class="line">                loader: <span class="string">'html-withimg-loader'</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.css$/</span>,</div><div class="line">                use: [</div><div class="line">                    <span class="string">'style-loader'</span>,</div><div class="line">                    <span class="string">'css-loader'</span></div><div class="line">                ]</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span>,</div><div class="line">                loader: <span class="string">'url-loader?limit=10000'</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                test: <span class="regexp">/\.(woff2?|eot|ttf|otf)(\?.*)?$/</span>,</div><div class="line">                loader: <span class="string">'url-loader?limit=10000'</span></div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    plugins: [</div><div class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</div><div class="line">            template: resolve(<span class="string">'show.html'</span>),</div><div class="line">            inject: <span class="string">'body'</span>,</div><div class="line">            hash: <span class="literal">false</span></div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="keyword">new</span> CommonsChunkPlugin(&#123;</div><div class="line">            name: <span class="string">'vendor'</span>,</div><div class="line">            chunks: [<span class="string">'show'</span>],</div><div class="line">            minChunks: <span class="function"><span class="params">module</span> =&gt;</span> /lib/.test(<span class="built_in">module</span>.resource)</div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="keyword">new</span> CopyWebpackPlugin([&#123;</div><div class="line">            <span class="keyword">from</span>: resolve(<span class="string">'./show/reports'</span>),</div><div class="line">            to: resolve(<span class="string">'./dist/images'</span>)</div><div class="line">        &#125;]),</div><div class="line"></div><div class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</div><div class="line">            compress: &#123;</div><div class="line">                screw_ie8: <span class="literal">true</span></div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/31/angular-cli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zxhfighter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端花园">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/31/angular-cli/" itemprop="url">angular-cli 指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-31T00:00:00+08:00">
                2017-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/angular/" itemprop="url" rel="index">
                    <span itemprop="name">angular</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/angular/angular-cli" target="_blank" rel="external">angular-cli</a> 是一个能帮助你快速创建 Angular 项目的脚手架工具。并提供了项目创建、开发、托管、构建、Lint、测试等一套完整的工作流。</p>
<p>本篇博客将介绍一些 angular-cli 的使用注意事项，希望这篇博客能够节省你一些时间。</p>
<h2 id="Node-和-NPM-版本要求"><a href="#Node-和-NPM-版本要求" class="headerlink" title="Node 和 NPM 版本要求"></a>Node 和 NPM 版本要求</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> node -v</div><div class="line"><span class="meta">$</span> npm -v</div></pre></td></tr></table></figure>
<p>其中 Node 版本需要 6.9.0+，NPM 需要 3.0.0+。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>如果之前安装了，升级到最新版本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> npm uninstall -g @angular/cli</div><div class="line"><span class="meta">$</span> npm cache clean</div><div class="line"><span class="meta">$</span> npm install -g @angular/cli@latest</div></pre></td></tr></table></figure>
<h2 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h2><p>新建项目前，可以设置新项目下载 NPM 包的 registry 来提高下载速度，这里设置成 cnpm。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng set --global packageManager=cnpm</div></pre></td></tr></table></figure>
<p>创建新项目使用 <code>ng new</code> 命令，可以根据项目要求按需提供一些参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng new lego --skip-tests=true --style=less --prefix=lego</div></pre></td></tr></table></figure>
<ul>
<li><code>--skip-tests=true</code> 属性忽略生成组件测试文件（e2e及测试相关配置文件需要手动删除）</li>
<li><code>--style=less</code> 属性指定样式文件名后缀为 less（默认为 css），默认样式也可以通过设置命令来修改：<code>ng set defaults.styleExt less</code></li>
<li><code>--prefix=lego</code> 属性指定有所有组件的标签选择器前缀为 <code>lego-</code>（默认为 <code>app-</code>）</li>
</ul>
<p>最后，这些属性可以在 <code>.angular-cli.json</code> 配置文件中去修改。</p>
<p>生成的项目目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── README.md            ----- 说明</div><div class="line">├── e2e                  ----- 端到端测试</div><div class="line">├── karma.conf.js        ----- 测试配置文件</div><div class="line">├── node_modules         ----- 库</div><div class="line">├── package.json         ----- 包描述文件</div><div class="line">├── protractor.conf.js   ----- 端到端配置文件</div><div class="line">├── src                  ----- 源目录</div><div class="line">├── tsconfig.json        ----- TS编译配置文件</div><div class="line">└── tslint.json          ----- 代码风格检查文件</div></pre></td></tr></table></figure>
<h2 id="启动应用"><a href="#启动应用" class="headerlink" title="启动应用"></a>启动应用</h2><p>按照约定俗称的习惯，可以先使用 <code>npm start</code> 命令启动和托管应用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> npm start</div></pre></td></tr></table></figure>
<p>按照提示打开 <code>http://localhost:4200</code>，不出意外，会看到应用程序已经成功启动了。</p>
<p>一般来说，我们希望启动应用后直接打开浏览器，刚才的 <code>npm start</code> 命令其实只是调用了 <code>ng serve</code> 命令，这个命令可以使用参数 <code>--open</code> 直接打开浏览器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng serve --open</div></pre></td></tr></table></figure>
<p>如果默认的端口被占用，可以配置新的端口以及 host（有些情况下会出现 Invalid Host Name错误，此时需要显示配置 host）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng serve --host 0.0.0.0 --port 4201 --open</div></pre></td></tr></table></figure>
<h2 id="实时更新-Live-Reload"><a href="#实时更新-Live-Reload" class="headerlink" title="实时更新(Live Reload)"></a>实时更新(Live Reload)</h2><p>打开 <code>app.component.html</code>，修改其中的任意内容，保存后看网页是否实时刷新。</p>
<p>打开 <code>app.component.css</code>（或者 <code>.less</code>），添加内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">h1</span> &#123;</div><div class="line">    <span class="attribute">color</span>: red;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不出意外，标题变红了！</p>
<p>打开 <code>app.component.ts</code>，修改为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppComponent</span> </span>&#123;</div><div class="line">  title = <span class="string">"Lego"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>页面标题也实时刷新。</p>
<p>不过细心的人会发现，这种实时刷新是整个页面刷新，并不是热加载局部刷新，下边的热加载更新会介绍如何来尽可能做到局部刷新。</p>
<h2 id="风格检查-Lint"><a href="#风格检查-Lint" class="headerlink" title="风格检查(Lint)"></a>风格检查(Lint)</h2><p>可以运行 <code>ng lint</code> 来检查，这些检查的 rules 规则定义在 <code>tslint.json</code> 中，相关 rules 规则的解释可以查看 <a href="https://gist.github.com/zxhfighter/c3bcbf5a86073a77cc7836a06533a2cd" target="_blank" rel="external">gist</a>。</p>
<p>其中的规则结合了 tslint 的规则（针对 TS）和 codelyzer（针对 Angular ） 的一些规则。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"rulesDirectory"</span>: [</div><div class="line">    <span class="string">"node_modules/codelyzer"</span></div><div class="line">  ],</div><div class="line">  <span class="attr">"rules"</span>: &#123;</div><div class="line">    <span class="attr">"arrow-return-shorthand"</span>: <span class="literal">true</span>,</div><div class="line">    // ...</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng lint</div></pre></td></tr></table></figure>
<p>会提示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ERROR: /Users/apps/lego/src/app/app.component.ts[9, 11]: &quot; should be &apos;</div><div class="line"></div><div class="line">Lint errors found in the listed files.</div></pre></td></tr></table></figure>
<p>其中，<code>Command</code> + 鼠标单击可以跳转到特定的代码位置，去修改相应代码。</p>
<p>其中 lint 还有一些可选参数，其中的 <code>--fix</code> 参数能够修复一些简单的错误，不过不要过分依赖这个自动修复。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng lint --fix</div></pre></td></tr></table></figure>
<p>不过，手动运行 lint 还是有点麻烦，如果想在修改完一个文件后实时 lint，这个需要怎么做，这个大家可以思考思考。</p>
<p>好了，我们来看下构建吧。</p>
<h2 id="构建-Build"><a href="#构建-Build" class="headerlink" title="构建(Build)"></a>构建(Build)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng build</div></pre></td></tr></table></figure>
<p>构建会从 <code>.angular-cli.json</code> 中去读取相关配置。</p>
<p>上述命令默认为开发环境构建，等同于：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng build --target=development --environment=dev</div><div class="line"><span class="meta">$</span> ng build --dev --e=dev</div><div class="line"><span class="meta">$</span> ng build --dev</div><div class="line"><span class="meta">$</span> ng build</div></pre></td></tr></table></figure>
<p>其中用到了如下特性（关闭 aot 构建、生成 sourcemaps 等）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">--aot=false</div><div class="line">--envrionment=dev</div><div class="line">--output-hashing=media</div><div class="line">--sourcemaps=true</div><div class="line">--extract-css=false</div></pre></td></tr></table></figure>
<p>如果需要生成生成环境的构建，运行如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ng build --prod</div><div class="line"></div><div class="line">// 等同于</div><div class="line">$ ng build --target=production --environment=prod</div><div class="line">$ ng build --prod --env=prod</div></pre></td></tr></table></figure>
<p>默认开启的选项有（开启 aot 构建，关闭 sourcemaps 等）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">--aot=true</div><div class="line">--envrionment=prod</div><div class="line">--output-hashing=all</div><div class="line">--sourcemaps=false</div><div class="line">--extract-css=true</div></pre></td></tr></table></figure>
<p>我们可以看下默认构建的文件大小（生产环境）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ls -alh dist/</div><div class="line"></div><div class="line">-rw-r--r--   1 xxx  staff   5.3K  6 26 12:05 favicon.ico</div><div class="line">-rw-r--r--   1 xxx  staff   698B  6 26 12:05 index.html</div><div class="line">-rw-r--r--   1 xxx  staff   1.4K  6 26 12:05 inline.a5e3d2d7744618897ae8.bundle.js</div><div class="line">-rw-r--r--   1 xxx  staff   5.2K  6 26 12:05 main.8427633bb8b01b93cb97.bundle.js</div><div class="line">-rw-r--r--   1 xxx  staff    60K  6 26 12:05 polyfills.1afc07fd8ec7201977c6.bundle.js</div><div class="line">-rw-r--r--   1 xxx  staff     0B  6 26 12:05 styles.d41d8cd98f00b204e980.bundle.css</div><div class="line">-rw-r--r--   1 xxx  staff   223K  6 26 12:05 vendor.0d2bee3de7a805e4fab5.bundle.js</div></pre></td></tr></table></figure>
<p>最大的为 <code>vendor</code> 文件，有 223K 大小，gzip 压缩后（<code>gzip vendor.0d2bee3de7a805e4fab5.bundle.js</code>）也有 55K 大小。</p>
<h2 id="添加自己的环境变量"><a href="#添加自己的环境变量" class="headerlink" title="添加自己的环境变量"></a>添加自己的环境变量</h2><p>有时候我们需要添加自己的环境变量，例如添加一个参数 <code>hmr</code> 来控制是否开启热加载，可以分为三步：</p>
<ol>
<li>创建一个 <code>src/environments/enviroment.NAME.ts</code></li>
<li>添加 <code>{&quot;NAME&quot;: &#39;src/environments/enviroment.NAME.ts&#39;}</code> 到 <code>.anguler-cli.json</code> 的 <code>app[0].enviroments</code> 数组中</li>
<li>使用时添加 <code>--env=NAME</code> 参数</li>
</ol>
<h2 id="测试-Test"><a href="#测试-Test" class="headerlink" title="测试(Test)"></a>测试(Test)</h2><p>如果是库项目或者一些公有底层项目，一个项目需要配套的测试文件，可以使用 <code>ng test</code> 来进行单元测试，使用 <code>ng e2e</code> 来进行集成测试。</p>
<p>不过如果是变化频繁的业务型项目，可以看情况是否启用测试。</p>
<p>如果不需要测试，可以将相关测试文件全部删掉即可，另外用 <code>ng new</code> 和 <code>ng g</code> 生成项目和组件时，可以忽略生成测试文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng new lego --skip-tests=true</div><div class="line"><span class="meta">$</span> ng g c header --spec=false</div></pre></td></tr></table></figure>
<h2 id="脚手架-Scaffold"><a href="#脚手架-Scaffold" class="headerlink" title="脚手架(Scaffold)"></a>脚手架(Scaffold)</h2><p>可以使用命令快速生成项目代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Component     ng g component my-new-component</div><div class="line">Component     ng g component my-new-component</div><div class="line">Directive     ng g directive my-new-directive</div><div class="line">Pipe          ng g pipe my-new-pipe</div><div class="line">Service       ng g service my-new-service</div><div class="line">Class         ng g class my-new-class</div><div class="line">Guard         ng g guard my-new-guard</div><div class="line">Interface     ng g interface my-new-interface</div><div class="line">Enum          ng g enum my-new-enum</div><div class="line">Module        ng g module my-module</div></pre></td></tr></table></figure>
<h2 id="自定义脚手架"><a href="#自定义脚手架" class="headerlink" title="自定义脚手架"></a>自定义脚手架</h2><p>如果有自己的代码规范，那么使用脚手架生成的代码很可能就不符合代码规范，每一次需要 format（希望你不要人肉去改），还是挺麻烦的。</p>
<p>另外 <code>ng g c</code> 等命令的配置较少，没有针对一些样式格式的配置（例如默认缩进空格）。</p>
<p>我们来生成一个组件 <code>header</code>，不需要单测文件，使用了 <code>--spec=false</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng g c header --spec=false</div></pre></td></tr></table></figure>
<p>生成代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; Component, OnInit &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">  selector: <span class="string">'lego-header'</span>,</div><div class="line">  templateUrl: <span class="string">'./header.component.html'</span>,</div><div class="line">  styleUrls: [<span class="string">'./header.component.less'</span>]</div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">HeaderComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>() &#123; &#125;</div><div class="line"></div><div class="line">  ngOnInit() &#123;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们希望：空格默认为 4 个，并且 <code>import</code> 语句的大括号旁边没有空格，有两种方案解决这个问题：</p>
<ul>
<li>继续使用 <code>ng g</code> 等命令</li>
</ul>
<p>如果希望继续使用 <code>ng g</code> 等命令，需要修改 angular cli 的源代码，找到 <code>angular/cli/blueprints/component/files/__path__</code>目录，列出其中文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── __name__.component.__styleext__</div><div class="line">├── __name__.component.html</div><div class="line">├── __name__.component.spec.ts</div><div class="line">└── __name__.component.ts</div></pre></td></tr></table></figure>
<p>修改这些对应的模板文件即可。</p>
<p>此种方式的缺点是，直接修改了 <code>node_modules</code>!，很明显，此种方式是不利于团队的。</p>
<ul>
<li>不使用 <code>ng g</code> 命令</li>
</ul>
<p>另外一种方式是，不用 <code>ng g</code> 来生成组件，可以借助编辑器的 snippet 功能，自定义 snippet，此种方式也是非常不错的一种方式，缺点是需要新建多个文件（<code>ng g</code>则一次性生成了组件的多个文件）。</p>
<p>举个例子，用 vscode 自定义了一个组件的 snippet，在 ts 文件中，输入 <code>ngC</code> 就能看到该提示，按 tab 键就能自动填充了。</p>
<p>关于如何自定义 vscode 的 snippet，可以参考 <a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets" target="_blank" rel="external">官网文档</a>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">"Angular Component": &#123;</div><div class="line">    "prefix": "ngComponent",</div><div class="line">    "body": [</div><div class="line">      "import &#123;",</div><div class="line">      "    Component, Input, Output, EventEmitter, ",</div><div class="line">      "    OnInit, ViewEncapsulation, ChangeDetectionStrategy",</div><div class="line">      "&#125; from '@angular/core';\n",</div><div class="line">      "@Component(&#123;",</div><div class="line">      "    selector: '$&#123;1:tag-name&#125;',",</div><div class="line">      "    templateUrl: './$&#123;3:list.component.tpl.html&#125;',",</div><div class="line">      "    styleUrls: ['./$&#123;4:list.component.less&#125;'],",</div><div class="line">      "    encapsulation: ViewEncapsulation.Emulated,",</div><div class="line">      "    changeDetection: ChangeDetectionStrategy.Default",</div><div class="line">      "&#125;)",</div><div class="line">      "export class $&#123;2:ComponentName&#125;Component implements OnInit &#123;",</div><div class="line">      "    name = '$&#123;2:ComponentName&#125;';\n",</div><div class="line">      "    constructor() &#123;\n",</div><div class="line">      "    &#125;\n",</div><div class="line">      "    ngOnInit() &#123;\n",</div><div class="line">      "    &#125;",</div><div class="line">      <span class="string">"&#125;\n"</span></div><div class="line">    ],</div><div class="line">    "description": "Define an Angular Component"</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="热加载-HMR"><a href="#热加载-HMR" class="headerlink" title="热加载(HMR)"></a>热加载(HMR)</h2><p>由于 angular 的模块和组件设计机制，修改一个组件，最终的变动会冒泡到根组件和根模块，从而导致整个组件树刷新。</p>
<p>如果你仔细看了 angular-cli 的相关文档，会发现 <code>ng serve</code> 有一个 <code>hmr</code> 参数，我们来试一下。</p>
<p>为了测试 HMR 是否生效，可以做个实验，在 index.html 添加一个 input 输入框。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">lego-root</span>&gt;</span><span class="tag">&lt;/<span class="name">lego-root</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>应用启动后，在输入框输入若干文字，然后修改 app 组件中的任意内容，看刚才输入的文字是否还存在，如果存在的话，说明 HMR 生效了，否则说明 HMR 不生效，fallback 到了 livereload 功能。</p>
<p>也就是说 HMR 只会更新 <code>lego-root</code> 组件的内容，而 livereload 就是全页面刷新了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng serve --hmr --open</div></pre></td></tr></table></figure>
<p>实验之后，会发现 <code>--hmr</code> 并没有带来 HMR 的效果。</p>
<p>不过仔细看看命令启动时的文字提示，会看到如下的提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NOTICE Hot Module Replacement (HMR) is enabled for the dev server.</div><div class="line">  The project will still live reload when HMR is enabled,</div><div class="line">  but to take advantage of HMR additional application code is required</div><div class="line">  (not included in an Angular CLI project by default).</div><div class="line">  See https://webpack.github.io/docs/hot-module-replacement.html</div><div class="line">  for information on working with HMR for Webpack.</div></pre></td></tr></table></figure>
<p>大致意思是说，要实现 HMR 功能，需要添加 HMR 相关的额外代码，这些代码 angular cli 项目本身不提供，详情可以参见 <a href="https://webpack.github.io/docs/hot-module-replacement.html" target="_blank" rel="external">这个网址</a>。</p>
<p>不过上面的网址只是官方 webpack 的 hmr 介绍，对 angular-cli 的 HMR 如何配置并没有任何帮助，还是来看看 <a href="https://medium.com/@beeman/tutorial-enable-hrm-in-angular-cli-apps-1b0d13b80130" target="_blank" rel="external">这篇文章</a> 吧。</p>
<p>另外最近发现 angular/cli 的官网也有相关 <a href="https://github.com/angular/angular-cli/wiki/stories-configure-hmr" target="_blank" rel="external">story</a> 了。</p>
<p>配置完毕后，HMR 整体还是比 livereload 全页面要快不少的。</p>
<h2 id="代理-Proxy"><a href="#代理-Proxy" class="headerlink" title="代理(Proxy)"></a><a href="https://github.com/angular/angular-cli/wiki/stories-proxy" target="_blank" rel="external">代理(Proxy)</a></h2><p>例如我们一个站点 <code>http://localhost:4200/api</code>，想将所有 <code>/api</code> 开头的请求代理到 <code>http://localhost:3000</code>，可以使用 <code>--proxy-config</code> 参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng serve --proxy-config proxy.conf.json</div></pre></td></tr></table></figure>
<p>其中 <code>proxy.conf.json</code> 内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"/api"</span>: &#123;</div><div class="line">    <span class="attr">"target"</span>: <span class="string">"http://localhost:3000"</span>,</div><div class="line">    <span class="attr">"secure"</span>: <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除了单个路径，还可以代理多个路径，下边请求以 <code>/my</code>，<code>/many</code> 等开头的全部代理到 <code>http://localhost:3000</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> PROXY_CONFIG = [</div><div class="line">    &#123;</div><div class="line">        context: [</div><div class="line">            <span class="string">"/my"</span>,</div><div class="line">            <span class="string">"/many"</span>,</div><div class="line">            <span class="string">"/endpoints"</span>,</div><div class="line">            <span class="string">"/i"</span>,</div><div class="line">            <span class="string">"/need"</span>,</div><div class="line">            <span class="string">"/to"</span>,</div><div class="line">            <span class="string">"/proxy"</span></div><div class="line">        ],</div><div class="line">        target: <span class="string">"http://localhost:3000"</span>,</div><div class="line">        secure: <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = PROXY_CONFIG;</div></pre></td></tr></table></figure>
<p>如果深入了解下，<code>ng serve</code> 底层使用了 <code>webpack-dev-server</code>，而 <code>webpack-dev-server</code> 又使用了 <code>http-proxy-middleware</code>。</p>
<h2 id="启动多个APP"><a href="#启动多个APP" class="headerlink" title="启动多个APP"></a><a href="https://github.com/angular/angular-cli/wiki/stories-multiple-apps" target="_blank" rel="external">启动多个APP</a></h2><p>有时候需要启动多个 app，例如一个 app 提供 mock 数据服务，另一个 app 提供业务代码逻辑。</p>
<ul>
<li>第一步：修改 <code>.angular-cli.json</code> 的 <code>apps</code> 数组，添加一个新 app 配置对象后如下：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    "name": "mock",</div><div class="line">    "root": "src",</div><div class="line">    // ...</div><div class="line">    "main": "main.ts",</div><div class="line">    "polyfills": "polyfills.ts",</div><div class="line">    "test": "test.ts",</div><div class="line">    "tsconfig": "tsconfig.app.json",</div><div class="line">    "testTsconfig": "tsconfig.spec.json",</div><div class="line">    "prefix": "app",</div><div class="line">    ...</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    "name": "main"</div><div class="line">    "root": "src",</div><div class="line">    // ...</div><div class="line">    "main": "main2.ts",</div><div class="line">    "polyfills": "polyfills2.ts",</div><div class="line">    "test": "test2.ts",</div><div class="line">    "tsconfig": "tsconfig.app.json",</div><div class="line">    "testTsconfig": "tsconfig.spec.json",</div><div class="line">    "prefix": "app2",</div><div class="line">    ...</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>其中，新 app 配置对象需要修改 <code>main</code>、<code>pollyfills</code>、<code>test</code>、<code>prefix</code> 等字段，同时两个配置文件都添加了 <code>name</code> 字段。</p>
<ul>
<li>第二步：修改启动命令，添加 <code>-app</code> 参数。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng serve --app=mock &amp;&amp; ng serve --app main</div></pre></td></tr></table></figure>
<p><code>--app</code> 参数同时能接受序号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ng serve --app=0 &amp;&amp; ng serve --app 1</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>设置自定义下载源：<br><code>ng set --global packageManager=cnpm</code></li>
<li>新建项目忽略测试文件，使用 less：<br><code>ng new lego --skip-tests=true --style=less --prefix=lego</code></li>
<li>生成组件时不生产测试文件：<br><code>ng g c header --spec=false</code></li>
<li>托管应用使用 <code>--open</code> 自动打开浏览器：<br><code>ng serve --host 0.0.0.0 --port 4301 --open</code></li>
<li>代码检查后 <code>command + 鼠标单击</code> 定位错误，同时使用 <code>--fix</code> 来修复简单错误<br><code>ng lint --fix</code></li>
<li>配置 HMR 来提供开发效率</li>
<li>修改脚手架文件或者定义 snnipet 来统一代码规范</li>
<li>使用代理来进行请求拦截，适用于 mock 数据和真实数据切换等场景</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="zxhfighter" />
          <p class="site-author-name" itemprop="name">zxhfighter</p>
           
              <p class="site-description motion-element" itemprop="description">frontend, angular, angularjs, typescript, rxjs, spa, ionic, vue, vue.js, react, native react, nativescript</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zxhfighter</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  

  

  

  

  

  <script type="text/javascript" src="/js/src/screenfull.min.js?v=5.1.1"></script>

</body>
</html>
